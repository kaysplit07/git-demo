#!/bin/bash

# Namespace
NAMESPACE="cobalt"

# Output file
OUTPUT_FILE="feb5-pp4-ca-cert10.bkp.yml"

# List of secret names
SECRETS=("ca-cert10" "ca-cert11" "ca-cert12")  # Add more as needed

# Clear the output file before appending
> "$OUTPUT_FILE"

# Iterate through the list of secrets
for SECRET in "${SECRETS[@]}"; do
    echo "Backing up $SECRET in PEM format..."

    # Extract the Base64-encoded certificate from the secret
    CERT_BASE64=$(kubectl get secret "$SECRET" -n "$NAMESPACE" -o jsonpath="{.data.tls\.crt}")

    # Decode the Base64 certificate into PEM format
    if [[ -n "$CERT_BASE64" ]]; then
        echo -e "\n---\n$SECRET:" >> "$OUTPUT_FILE"
        echo "$CERT_BASE64" | base64 --decode >> "$OUTPUT_FILE"
    else
        echo "Warning: No certificate found for $SECRET"
    fi
done

echo "Backup complete. Output saved in $OUTPUT_FILE."
