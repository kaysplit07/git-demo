resource "azurerm_network_interface" "nic" {
  provider = azurerm.adt
  for_each = { for row_id, inst in local.final_parms_map : row_id => inst }
  location            = local.naming.location
  name                = (each.value).nic_name
  resource_group_name = (each.value).rg_name

  ip_configuration {
    name                          = join("-", [(each.value).vm_name, "nic_config" ])
    subnet_id                     = (each.value).nic_subnet_id
    private_ip_address_allocation = "Dynamic"

    # Associate NIC with load balancer's backend address pool
    load_balancer_backend_address_pools_ids = [azurerm_lb_backend_address_pool.internal_lb_bepool[each.key].id]
  }
}

