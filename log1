#!/bin/bash

# Input file containing multiple PEM certificates
input_file="allcerts-base64d-unique.txt"

# Split the file into individual certificates
awk '
  /-----BEGIN CERTIFICATE-----/{filename="cert" ++count ".pem"}
  {print > filename}
' < "$input_file"


###########
#!/bin/bash

# Directory containing individual certificates
cert_dir="."

# Loop through all certificate files
for cert_file in "$cert_dir"/cert*.pem; do
  echo "Checking $cert_file..."

  # Get the expiry date
  expiry_date=$(openssl x509 -enddate -noout -in "$cert_file" | cut -d= -f2)

  # Convert expiry date to a timestamp
  expiry_timestamp=$(date -d "$expiry_date" +%s)

  # Get the current timestamp
  current_timestamp=$(date +%s)

  # Compare the timestamps
  if [ "$expiry_timestamp" -lt "$current_timestamp" ]; then
    echo "Certificate $cert_file has EXPIRED (Expiry Date: $expiry_date)."
  else
    echo "Certificate $cert_file is VALID (Expiry Date: $expiry_date)."
  fi
done


##############
